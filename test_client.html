<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Client</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsmpeg/0.1/jsmpg.js"></script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-72761429-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-72761429-2');
  </script>

</head>
<style>
  canvas {
    height: 480px;
    width: 960px;
    margin: auto;
    position: relative;
    display: block;
    z-index: -1;
    /*top: 420px;*/
    left: 7px;
  }

  .tv {
    /*background: url(/img/tv.png) no-repeat center top; */
    /*width: 910px;*/
    /*height: 820px;*/
    background-size: 1168px;
    position: relative;
    margin: auto;
    /*top: -280px;*/
  }
  
  #message {
    text-align: center;
    font-family: sans-serif;
  }
  
  .advert {
    position: absolute;
    width: 960px;
    height: 480px;
    z-index: 1;
    margin: auto;
    top: 0;
    left: 14px;
    right: 0;
  }
  
  .advert img {
        width: 100px;
        display:none;
  }
</style>

<body>

  <div class="tv">
    <div class="advert">
      <img src="http://www.pngall.com/wp-content/uploads/2016/06/Skull-High-Quality-PNG.png">
    </div>
    <canvas id="canvas" width="640" height="360"></canvas>
    <p id="message"></p>
  </div>


  <script>
    var canvas = document.querySelector('canvas');

    setTimeout(function () {
      // var ws = new WebSocket('ws://localhost:9797');
      var ws = new WebSocket('ws://142.93.33.84/wsapp');
      // var ws = new WebSocket('ws://localhost:9797');
      var player = new jsmpeg(ws, {
        canvas: canvas
      });

      // var window_focus = true;

      // window.onblur = function () {
      //   ws.close();
      //   // player.destroy();
      //   console.log('Closed');
      // }
      // window.onfocus = function () {
      //   if (ws.CLOSED) {
      //     ws = new WebSocket('ws://localhost:9797');
      //     player = new jsmpeg(ws, {
      //       canvas: canvas
      //     });
      //   }
      //   console.log('Opening');
      // }

    }, 0);
    
    document.addEventListener("DOMContentLoaded", function(event) { 
      var str = `As of ${new Date().toDateString()}, this service is in beta and will not always function as expected. The service will restart every hour.`;
      document.querySelector('#message').textContent = str;
    });

    

    var ctx = document.getElementById("canvas").getContext("2d");
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    var img = new Image();
    img.onload = function () {
      ctx.drawImage(img,
        canvas.width / 2 - img.width / 2,
        canvas.height / 2 - img.height / 2);
      // ctx.drawImage(img, 0, 0);
    };
    img.src = "/img/loading.png"; 
  </script>
</body>

</html>
